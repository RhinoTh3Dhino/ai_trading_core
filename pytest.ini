[pytest]
minversion = 8.0

# Hvor pytest leder efter tests
testpaths =
    tests/venues
    tests/integration
    tests/persistence

# Test discovery
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Sørg for at projektroden er på import-stien
pythonpath = .

# Ignorer støjende/ikke-test mapper (inkl. Windows systemmapper)
norecursedirs =
    .git
    .venv
    .venv_*
    .pytest_cache
    htmlcov
    notebooks
    outputs
    logs
    backups
    archives
    artifacts
    mlruns
    ops
    docs
    $Recycle.Bin
    System Volume Information

# Asyncio-integration
asyncio_mode = auto

# Markers
markers =
    asyncio: mark test as asyncio-based
    slow: Langsomme tests (kan skippes i hurtige kørsler)
    integ: Integrationstests (end-to-end)
    gui: GUI-relaterede tests
    e2e: Fuld end-to-end pipeline-smoke (producerer artefakter)
    contract: Kontrakt-tests der kan kalde eksterne API'er (fx PnL/Telegram)
    heavy: Tunge tests der kræver native deps/store datasæt
    talib: Tests der kræver TA-Lib
    pandas_ta: Tests der kræver pandas_ta
    persistence: Fase-4 persistens/filhygiejne tests (utils/artifacts, rotation, arkiv)

# Standard-flags (coverage styres i CI – ikke her)
addopts =
    -vv
    -ra
    --maxfail=1
    --disable-warnings
    --strict-markers
    --timeout=30
    --durations=10
    --color=yes
    # Midlertidigt: udeluk tunge/native tests globalt (matcher CI)
    -k "not heavy and not talib and not pandas_ta"

# Undertryk specifikke, kendte advarsler
filterwarnings =
    ignore:.*'H' is deprecated and will be removed in a future version.*:FutureWarning
    ignore:Failed to extract font properties.*:UserWarning
    ignore:.*websockets\.legacy is deprecated.*:DeprecationWarning
    ignore:.*WebSocketServerProtocol is deprecated.*:DeprecationWarning
    ignore:.*Please use `import python_multipart` instead.*:PendingDeprecationWarning
    ignore:.*distutils package is deprecated.*:DeprecationWarning
    ignore:.*invalid escape sequence.*:DeprecationWarning

# CLI logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(levelname)s %(message)s
log_cli_date_format = %H:%M:%S

# Fejlfinder
faulthandler_timeout = 60

# Streng xfail
xfail_strict = true

# Cache-sti
cache_dir = .pytest_cache
