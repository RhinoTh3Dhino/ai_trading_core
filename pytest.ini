[pytest]
minversion = 8.0

# Hvor pytest leder efter tests
testpaths = tests

# Hvilke filer/klasser/funktioner t√¶lles som tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# S√∏rg for at projektroden er p√• import-stien
pythonpath = .

# Ignorer st√∏jende mapper (venv, git, cache, artefakter, observability)
norecursedirs =
    .git
    .venv
    .venv_*
    .pytest_cache
    htmlcov
    notebooks
    outputs
    logs
    backups
    mlruns
    ops
    docs

# Asyncio-integration (kr√¶ver pytest-asyncio >= 0.20)
asyncio_mode = auto

# Markers (brug --strict-markers for at fange stavefejl)
markers =
    asyncio: mark test as asyncio-based
    slow: Langsomme tests (kan skippes i hurtige k√∏rsler)
    integ: Integrationstests (end-to-end)
    gui: GUI-relaterede tests
    e2e: Fuld end-to-end pipeline-smoke (producerer artefakter)
    contract: Kontrakt-tests der kan kalde eksterne API'er (fx PnL/Telegram)
    heavy: Tunge tests der kr√¶ver native deps/store datas√¶t
    talib: Tests der kr√¶ver TA-Lib
    pandas_ta: Tests der kr√¶ver pandas_ta

# Standard-flags
addopts =
    -vv
    -ra
    --maxfail=1
    --disable-warnings
    --strict-markers
    --timeout=30
    --durations=10
    --color=yes
    # coverage ‚Äì brug .coveragerc til kilder/omit
    --cov
    --cov-config=.coveragerc
    --cov-report=term-missing:skip-covered
    --cov-report=html
    --cov-report=xml:reports/coverage.xml
    # midlertidigt m√•l ‚Äì h√¶v n√•r flere tests er p√• plads
    --cov-fail-under=40
    # CI-artefakt
    --junitxml=reports/junit.xml
    # ignorer filer/mapper som ikke er tests
    --ignore=test.txt
    --ignore=README.md
    --ignore=outputs
    --ignore=data
    --ignore=notebooks
    --ignore=ops
    --ignore=docs
    # üîß Midlertidigt: udeluk tunge/native tests globalt (matcher CI)
    -k "not heavy and not talib and not pandas_ta"

# Undertryk specifikke, kendte advarsler
filterwarnings =
    ignore:.*'H' is deprecated and will be removed in a future version.*:FutureWarning
    ignore:Failed to extract font properties.*:UserWarning

# CLI logging (nyttigt n√•r tests fejler p√• CI)
log_cli = true
log_cli_level = INFO
log_cli_format = %(levelname)s %(message)s
log_cli_date_format = %H:%M:%S

# Fejlfinder (stopper h√¶ngende tests p√¶nt)
faulthandler_timeout = 60

# Streng xfail (xfail t√¶lles som fejl hvis de pludselig passerer)
xfail_strict = true

# Cache-sti (holder ro i repoet)
cache_dir = .pytest_cache
