[pytest]
minversion = 8.0

# Hvor pytest leder efter tests
testpaths = tests

# Hvilke filer/klasser/funktioner tælles som tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Sørg for at projektroden er på import-stien
pythonpath = .

# Ignorer støjende mapper (venv, git, cache, artefakter)
norecursedirs =
    .git
    .venv
    .venv_tf_gpu
    .pytest_cache
    htmlcov
    notebooks
    outputs
    logs
    backups
    mlruns

# Markers (brug --strict-markers for at fange stavefejl)
markers =
    slow: Langsomme tests (kan skippes i hurtige kørsler)
    integ: Integrationstests (end-to-end)
    gui: GUI-relaterede tests
    e2e: Fuld end-to-end pipeline-smoke (producerer artefakter)
    contract: Kontrakt-tests der kan kalde eksterne API'er (fx PnL/Telegram)

# Standard-flags
addopts =
    -vv
    -ra
    --maxfail=1
    --disable-warnings
    --strict-markers
    --timeout=20
    --durations=10
    --color=yes
    # coverage – brug .coveragerc til kilder/omit
    --cov
    --cov-config=.coveragerc
    --cov-report=term-missing:skip-covered
    --cov-report=html
    --cov-report=xml:reports/coverage.xml
    # midlertidigt mål – hæv når flere tests er på plads
    --cov-fail-under=40
    # CI-artefakt
    --junitxml=reports/junit.xml
    # ignorer filer/mapper som ikke er tests
    --ignore=test.txt
    --ignore=README.md
    --ignore=outputs
    --ignore=data
    --ignore=notebooks

# Undertryk specifikke, kendte advarsler
filterwarnings =
    ignore:.*'H' is deprecated and will be removed in a future version.*:FutureWarning

# CLI logging (nyttigt når tests fejler på CI)
log_cli = true
log_cli_level = INFO
log_cli_format = %(levelname)s %(message)s
log_cli_date_format = %H:%M:%S

# Fejlfinder (stopper hængende tests pænt)
faulthandler_timeout = 60

# Streng xfail (xfail tælles som fejl hvis de pludselig passerer)
xfail_strict = true

# Cache-sti (holder ro i repoet)
cache_dir = .pytest_cache
